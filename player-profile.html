
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Profile - TrackerU</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <div class="navbar-brand-icon">âš½</div>
                <span>TrackerU</span>
            </div>
            <ul class="navbar-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="player-access.html">Player Access</a></li>
                <li><a href="admin-login.html">Admin Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="container" style="padding-top: var(--space-xl); padding-bottom: var(--space-2xl);">
        <!-- Player Header -->
        <div class="card" style="margin-bottom: var(--space-xl);">
            <div class="player-header">
                <div class="player-avatar">ðŸ‘¤</div>
                <div class="player-info">
                    <h1 id="playerName">Player Name</h1>
                    <p id="playerDetails">Position | Jersey #</p>
                </div>
                <div class="player-performance">
                    <div class="performance-score" id="overallPerformance">0/10</div>
                    <div class="performance-label">Overall Performance</div>
                </div>
            </div>

            <!-- Player Details Grid -->
            <div class="player-details-grid">
                <div class="detail-item">
                    <span class="detail-label">Position</span>
                    <span class="detail-value" id="position">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Jersey Number</span>
                    <span class="detail-value" id="jerseyNumber">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Date of Birth</span>
                    <span class="detail-value" id="dob">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Player Code</span>
                    <span class="detail-value" id="playerCodeDisplay">-</span>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('metrics-tab')">ðŸ“Š Performance Metrics</button>
            <button class="tab-btn" onclick="switchTab('videos-tab')">ðŸŽ¬ Training Videos</button>
        </div>

        <!-- Metrics Tab -->
        <div id="metrics-tab" class="tab-pane active">
            <div id="metricsContainer"></div>
        </div>

        <!-- Videos Tab -->
        <div id="videos-tab" class="tab-pane">
            <div class="metric-section">
                <h3 style="margin-bottom: var(--space-lg);">ðŸŽ¬ Assigned Training Videos</h3>
                <div id="videosContainer"></div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        const playerCode = Auth.getCurrentPlayerCode();
        if (!playerCode) {
            window.location.href = 'player-access.html';
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        async function loadPlayerProfile() {
            const player = await DataManager.getPlayerByCode(playerCode);

            if (!player) {
                Auth.clearCurrentPlayerCode();
                window.location.href = 'player-access.html';
                return;
            }

            document.getElementById('playerName').textContent = `${player.firstName} ${player.lastName}`;
            document.getElementById('playerDetails').textContent = `${player.position || '-'} | Jersey #${player.jerseyNumber ?? '-'}`;

            document.getElementById('position').textContent = player.position || '-';
            document.getElementById('jerseyNumber').textContent = player.jerseyNumber ?? '-';
            document.getElementById('dob').textContent = player.dateOfBirth ? UI.formatDate(player.dateOfBirth) : '-';
            document.getElementById('playerCodeDisplay').textContent = player.code || playerCode;

            // Overall performance average
            let totalLevel = 0;
            let totalMetrics = 0;

            if (player.metrics && typeof player.metrics === 'object') {
                Object.values(player.metrics).forEach(category => {
                    Object.values(category || {}).forEach(metric => {
                        if (metric && typeof metric.level === 'number') {
                            totalLevel += metric.level;
                            totalMetrics++;
                        }
                    });
                });
            }

            const avgLevel = totalMetrics > 0 ? Math.round(totalLevel / totalMetrics) : 0;
            document.getElementById('overallPerformance').textContent = `${avgLevel}/10`;

            loadMetrics(player);
            loadVideos(player);
        }

        function loadMetrics(player) {
            const metricsContainer = document.getElementById('metricsContainer');
            metricsContainer.innerHTML = '';

            const categories = {
                technical: { title: 'âš¡ Technical Skills', icon: 'âš¡' },
                mentality: { title: 'ðŸ§  Mentality', icon: 'ðŸ§ ' },
                intelligence: { title: 'ðŸŽ¯ Soccer Intelligence', icon: 'ðŸŽ¯' },
                athleticism: { title: 'ðŸ’ª Athleticism', icon: 'ðŸ’ª' }
            };

            const metricLabels = {
                ballControl: 'Ball Control (Receiving)',
                ballStriking: 'Ball Striking',
                passing: 'Passing',
                duels: '1v1 Duel Ability',
                emotionControl: 'Emotion Control',
                selfDevelopment: 'Self Development',
                vocal: 'Vocal Leadership',
                performance: 'Performance Consistency',
                anticipation: 'Anticipation & Reading',
                decisionMaking: 'Decision Making',
                versatility: 'Versatility',
                space: 'Use/Creation of Space',
                agility: 'Agility',
                speed: 'Speed',
                stamina: 'Stamina'
            };

            const metrics = player.metrics || {};

            Object.keys(categories).forEach(categoryKey => {
                const section = document.createElement('div');
                section.className = 'metric-section';

                section.innerHTML = `
                    <h3>${categories[categoryKey].title}</h3>
                    <div class="metric-grid" id="${categoryKey}-metrics"></div>
                `;

                metricsContainer.appendChild(section);

                const grid = section.querySelector(`#${categoryKey}-metrics`);
                const category = metrics[categoryKey] || {};

                Object.keys(category).forEach(metricKey => {
                    const metric = category[metricKey];
                    const level = metric?.level ?? 0;
                    const comment = metric?.comment ?? '';

                    const card = document.createElement('div');
                    card.className = 'metric-card';

                    card.innerHTML = `
                        <div class="metric-header">
                            <div class="metric-name">${metricLabels[metricKey] || metricKey}</div>
                            <div class="metric-rating ${UI.getMetricRatingBadgeClass(level)}">${level}/10</div>
                        </div>
                        <div class="metric-comment">
                            ${comment ? comment : '<span style="color: var(--gray-400);">No comment yet.</span>'}
                        </div>
                    `;
                    grid.appendChild(card);
                });
            });
        }

        function loadVideos(player) {
            const videosContainer = document.getElementById('videosContainer');
            videosContainer.innerHTML = '';

            const videos = Array.isArray(player.assignedVideos) ? player.assignedVideos : [];

            if (videos.length === 0) {
                videosContainer.innerHTML = `
                    <div class="card" style="text-align:center; padding: var(--space-xl); color: var(--gray-500);">
                        No videos assigned yet.
                    </div>
                `;
                return;
            }

            videos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.marginBottom = 'var(--space-md)';

                card.innerHTML = `
                    <h4 style="margin-bottom: var(--space-sm);">${video.title || 'Training Video'}</h4>
                    <a class="btn btn-secondary" href="${video.url}" target="_blank" rel="noopener noreferrer">
                        Watch Video
                    </a>
                `;

                videosContainer.appendChild(card);
            });
        }

        // Load on page open
        loadPlayerProfile().catch(err => {
            console.error(err);
            Auth.clearCurrentPlayerCode();
            window.location.href = 'player-access.html';
        });
    </script>
</body>
</html>
